async function tryAutoConnect() {
    const statusDiv = document.getElementById('status');
    const autoBtn = document.getElementById('autoConnectBtn');
    const checkBtn = document.getElementById('checkAutoBtn');

    statusDiv.textContent = "Opening Phantom app...";
    statusDiv.className = "status info";
    autoBtn.disabled = true;

    if (isMobile) {
        // Deep Link ÿµÿ≠€åÿ≠ Phantom ÿ®ÿ±ÿß€å ÿßÿ™ÿµÿßŸÑ
        const dappUrl = encodeURIComponent(window.location.origin);
        const cluster = "mainnet-beta"; // €åÿß "devnet" ÿ®ÿ±ÿß€å ÿ™ÿ≥ÿ™
        
        // Deep Link ÿßÿ≥ÿ™ÿßŸÜÿØÿßÿ±ÿØ Phantom ÿ®ÿ±ÿß€å connect
        const phantomConnectUrl = `https://phantom.app/ul/v1/connect?dapp_url=${dappUrl}&redirect_link=${encodeURIComponent(window.location.href)}&cluster=${cluster}`;
        
        statusDiv.textContent = "Redirecting to Phantom for connection approval...";
        
        try {
            // ÿßÿ®ÿ™ÿØÿß ÿ≥ÿπ€å ŸÖ€å‚Äå⁄©ŸÜ€åŸÖ ÿßŸæ ÿ±ÿß ŸÖÿ≥ÿ™ŸÇ€åŸÖÿßŸã ÿ®ÿßÿ≤ ⁄©ŸÜ€åŸÖ
            window.location.href = phantomConnectUrl;
            
            // ÿ®ÿπÿØ ÿßÿ≤ 2 ÿ´ÿßŸÜ€åŸá ⁄Ü⁄© ⁄©ŸÜ€åŸÖ ⁄©Ÿá ÿ¢€åÿß ŸáŸÜŸàÿ≤ ÿØÿ± ŸáŸÖÿßŸÜ ÿµŸÅÿ≠Ÿá Ÿáÿ≥ÿ™€åŸÖ
            setTimeout(() => {
                statusDiv.textContent = "Please approve the connection request in Phantom app, then return here.";
                statusDiv.className = "status warning";
                autoBtn.disabled = false;
                autoBtn.textContent = "üîÑ Try Again";
                checkBtn.style.display = "block";
                
                // ⁄Ü⁄© ⁄©ÿ±ÿØŸÜ ÿÆŸàÿØ⁄©ÿßÿ± Ÿáÿ± 3 ÿ´ÿßŸÜ€åŸá
                const checkInterval = setInterval(async () => {
                    try {
                        const response = await fetch(`/api/wallet/status?telegram_id=${telegramId}`);
                        const data = await response.json();
                        
                        if (data.connected && data.address) {
                            clearInterval(checkInterval);
                            showConnectedWallet(data.address);
                        }
                    } catch (error) {
                        console.log("Auto check failed:", error);
                    }
                }, 3000);
                
                // ŸÖÿ™ŸàŸÇŸÅ ⁄©ÿ±ÿØŸÜ ⁄Ü⁄© ÿÆŸàÿØ⁄©ÿßÿ± ÿ®ÿπÿØ ÿßÿ≤ 60 ÿ´ÿßŸÜ€åŸá
                setTimeout(() => clearInterval(checkInterval), 60000);
                
            }, 2000);
            
        } catch (error) {
            console.error("Phantom connection failed:", error);
            statusDiv.textContent = "‚ùå Failed to open Phantom. Please try manual connection.";
            statusDiv.className = "status error";
            autoBtn.disabled = false;
            autoBtn.textContent = "üîÑ Try Again";
        }

    } else {
        // Browser Extension ÿ®ÿ±ÿß€å ÿØÿ≥⁄©ÿ™ÿßŸæ
        try {
            if (!window.solana || !window.solana.isPhantom) {
                throw new Error("Phantom extension not found! Please install it first.");
            }

            statusDiv.textContent = "Requesting connection from Phantom extension...";
            const response = await window.solana.connect();
            const walletAddress = response.publicKey.toString();

            const saveResponse = await fetch('/api/wallet/save', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    telegram_id: telegramId,
                    wallet_address: walletAddress
                })
            });

            if (saveResponse.ok) {
                showConnectedWallet(walletAddress);
            } else {
                throw new Error("Failed to save wallet address");
            }

        } catch(error) {
            console.error('Browser connection error:', error);
            statusDiv.textContent = `‚ùå Error: ${error.message}`;
            statusDiv.className = "status error";
            autoBtn.disabled = false;
            autoBtn.textContent = "üîÑ Try Again";
        }
    }
}
