<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="csrf-token" content="{{ request.session.csrf_token }}">
<title>Airdrop</title>
<link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', path='css/airdrop.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>

<style>
/* ÿßÿ≥ÿ™ÿß€åŸÑ ŸÖŸÜŸà€å ⁄©ÿ¥Ÿà€å€å ⁄©€åŸÅ ŸæŸàŸÑ */
.wallet-dropdown {
position: relative;
display: inline-block;
width:100%;
}

.wallet-dropdown-content {
display: none;
position: absolute;
background-color:#1a1a1a;
min-width:100%;
box-shadow:0px 8px 16px 0px rgba(0,0,0,0.3);
z-index:9999;
border-radius:10px;
border:2px solid #333;
top:calc(100% + 2px);
left:0;
opacity:0;
transform:translateY(-10px);
transition: all 0.3s ease;
margin-top:0;
}

.wallet-dropdown-content.show {
display: block;
opacity:1;
transform:translateY(0);
}

.wallet-info-dropdown {
background:#1a1a1a;
padding:15px;
border-radius:8px;
text-align: left;
color:#fff;
}

.wallet-address-dropdown {
font-family: monospace;
font-size:11px;
word-break: break-all;
background:#2d2d2d;
padding:8px;
border-radius:5px;
margin:8px 0;
color:#fff;
border:1px solid #444;
max-height:60px;
overflow-y: auto;
}

.wallet-actions-dropdown {
display: flex;
gap:8px;
margin-top:10px;
}

.wallet-action-btn {
background:#333;
color: white;
border:1px solid #555;
padding:10px 15px;
border-radius:6px;
font-size:12px;
cursor: pointer;
flex:1;
text-align: center;
transition: all 0.3s ease;
font-weight:500;
}

.wallet-action-btn:hover {
background:#444;
transform:translateY(-1px);
}

.disconnect-btn {
background:#2d2d2d;
color:#ff4757;
border-color:#ff4757;
}

.disconnect-btn:hover {
background:#ff4757;
color:#fff;
}

.change-btn {
background:#2d2d2d;
color:#ffa502;
border-color:#ffa502;
}

.change-btn:hover {
background:#ffa502;
color:#000;
}

.wallet-connect-button {
position: relative;
}

.wallet-status-indicator {
position: absolute;
top:-3px;
right:-3px;
width:14px;
height:14px;
background:#28a745;
border-radius:50%;
display: none;
border:2px solid #fff;
box-shadow:0 0 0 1px #28a745;
}

.wallet-status-indicator.connected {
display: block;
animation: pulse 2s infinite;
}

@keyframes pulse {
0% {
box-shadow:0 0 0 0 rgba(40,167,69,0.7);
}
70% {
box-shadow:0 0 0 10px rgba(40,167,69,0);
}
100% {
box-shadow:0 0 0 0 rgba(40,167,69,0);
}
}

.task-button.wallet-connected .right-icon,
.task-button.commission-paid .right-icon,
.task-button.tasks-completed .right-icon,
.task-button.friends-invited .right-icon {
color:#28a745!important;
}

.task-box.completed {
border-color:#28a745;
}

.task-box.completed .task-button {
background:rgba(40,167,69,0.1);
}

.fa-check {
color:#28a745;
font-weight: bold;
}

.task-box {
margin-bottom:15px;
position: relative;
}

.wallet-dropdown {
z-index:10;
}

.wallet-dropdown-content {
position: absolute;
top:100%;
left:0;
right:0;
}

.task-box:has(.wallet-dropdown) {
z-index:10;
}

.task-box:not(:has(.wallet-dropdown)) {
z-index:1;
}

#connect-wallet {
margin-bottom:20px;
}

#pay-commission {
margin-top:5px;
}

.task-button.loading {
opacity:0.7;
pointer-events: none;
}

.task-button.loading .right-icon {
animation: spin 1s linear infinite;
}

@keyframes spin {
from { transform:rotate(0deg); }
to { transform:rotate(360deg); }
}

.toast {
position: fixed;
top:20px;
right:20px;
padding:15px 20px;
border-radius:8px;
color: white;
font-weight:500;
z-index:10000;
max-width:300px;
word-wrap: break-word;
box-shadow:0 4px 12px rgba(0,0,0,0.3);
transform:translateX(100%);
transition: transform 0.3s ease;
}

.toast.show {
transform:translateX(0);
}

.toast-success {
background:#28a745;
}

.toast-error {
background:#dc3545;
}

.toast-info {
background:#007bff;
}

@media (max-width:480px) {
.wallet-address-dropdown {
font-size:10px;
padding:6px;
}

.wallet-action-btn {
padding:8px 10px;
font-size:11px;
}

.task-box {
margin-bottom:12px;
}

.toast {
top:10px;
right:10px;
left:10px;
max-width: none;
}
}

/* ÿßÿ≥ÿ™ÿß€åŸÑ ÿ®ÿ±ÿß€å ÿØ⁄©ŸÖŸá ŸÜÿµÿ® Phantom */
.install-phantom-btn {
background: linear-gradient(135deg, #9945FF 0%, #14F195 100%);
color: white;
border: none;
padding: 15px 25px;
border-radius: 12px;
font-weight: 600;
font-size: 14px;
cursor: pointer;
transition: all 0.3s ease;
display: flex;
align-items: center;
gap: 10px;
justify-content: center;
width: 100%;
margin: 10px 0;
}

.install-phantom-btn:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(153, 69, 255, 0.3);
}

.connect-phantom-btn {
background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
color: white;
border: none;
padding: 15px 25px;
border-radius: 12px;
font-weight: 600;
font-size: 14px;
cursor: pointer;
transition: all 0.3s ease;
display: flex;
align-items: center;
gap: 10px;
justify-content: center;
width: 100%;
margin: 10px 0;
}

.connect-phantom-btn:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
}

.phantom-icon {
width: 24px;
height: 24px;
background: url('data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiBoZWlnaHQ9IjM0IiB3aWR0aD0iMzQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGxpbmVhckdyYWRpZW50IGlkPSJhIiB4MT0iLjUiIHgyPSIuNSIgeTE9IjAiIHkyPSIxIj48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiM1MzRiYjEiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM1NTFiZjkiLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0iYiIgeDE9Ii41IiB4Mj0iLjUiIHkxPSIwIiB5Mj0iMSI+PHN0b3Agb2Zmc2V0PSIwIiBzdG9wLWNvbG9yPSIjZmZmIi8+PHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjZmZmIiBzdG9wLW9wYWNpdHk9Ii44MiIvPjwvbGluZWFyR3JhZGllbnQ+PGNpcmNsZSBjeD0iMTciIGN5PSIxNyIgZmlsbD0idXJsKCNhKSIgcj0iMTciLz48cGF0aCBkPSJtMTQuMzYgMTQuMzMtLjk2LS45NmE1LjUgNS41IDAgMCAwIDQgMS4zMWgxLjMzYTEuNSAxLjUgMCAwIDAgMC0zSDEyYTUuNSA1LjUgMCAwIDAgMCAwaC0uNWExLjUgMS41IDAgMCAwIDAgM2gxMGExLjUgMS41IDAgMCAwIDAtM2gtNi4xNFoiIGZpbGw9InVybCgjYikiLz48L3N2Zz4=') no-repeat center;
background-size: contain;
}
</style>
</head>

<body>
<div class="container">
<div class="box">
<div class="countdown">
<span id="days">00</span>d :
<span id="hours">00</span>h :
<span id="minutes">00</span>m :
<span id="seconds">00</span>s
</div>
<div class="token-value">
<p>1 CCoin = $ 0.02</p>
</div>
</div>

<div class="airdrop-criteria">
<h2>Airdrop Criteria</h2>

<div id="task-completion" class="task-box">
<button class="task-button" id="task-completion-btn">
<span class="left-text">Tasks Completion</span>
<i class="fas fa-chevron-right right-icon"></i>
</button>
</div>

<div id="inviting-friends" class="task-box">
<button class="task-button" id="inviting-friends-btn">
<span class="left-text">Inviting Friends</span>
<i class="fas fa-chevron-right right-icon"></i>
</button>
</div>

<!-- ⁄©€åŸÅ ŸæŸàŸÑ ÿ®ÿß ŸÖŸÜŸà€å ⁄©ÿ¥Ÿà€å€å -->
<div id="connect-wallet" class="task-box">
<div class="wallet-dropdown" id="wallet-dropdown">
<button class="task-button wallet-connect-button" id="wallet-connect-btn">
<span class="left-text" id="wallet-button-text">Connect Wallet</span>
<div class="wallet-status-indicator" id="wallet-status-indicator"></div>
<i class="fas fa-chevron-right right-icon" id="wallet-icon"></i>
</button>
<!-- ŸÖŸÜŸà€å ⁄©ÿ¥Ÿà€å€å -->
<div id="wallet-dropdown-content" class="wallet-dropdown-content">
<div class="wallet-info-dropdown">
<div><strong>‚úÖ Connected Wallet:</strong></div>
<div id="wallet-address-dropdown" class="wallet-address-dropdown"></div>
<div class="wallet-actions-dropdown">
<button class="wallet-action-btn change-btn" id="change-wallet-btn">
üîÑ Change
</button>
<button class="wallet-action-btn disconnect-btn" id="disconnect-wallet-btn">
üö´ Disconnect
</button>
</div>
</div>
</div>
</div>
</div>

<div id="pay-commission" class="task-box">
<button class="task-button" id="commission-button">
<span class="left-text" id="commission-button-text">Pay for the Commission</span>
<i class="fas fa-chevron-right right-icon" id="commission-icon"></i>
</button>
</div>

</div>

<div class="footer-icons">
<a href="/leaders" class="footer-btn">
<i class="fas fa-medal"></i>
<span>Leaders</span>
</a>
<a href="/friends" class="footer-btn">
<i class="fas fa-user-friends"></i>
<span>Friends</span>
</a>
<a href="/home" class="footer-btn">
<i class="fas fa-home"></i>
<span>Home</span>
</a>
<a href="/earn" class="footer-btn">
<i class="fas fa-coins"></i>
<span>Earn</span>
</a>
<a href="/airdrop" class="footer-btn active">
<i class="fas fa-rocket"></i>
<span>AirDrop</span>
</a>
</div>
</div>

<!-- ŸÖÿ™ÿ∫€åÿ±Ÿáÿß€å ÿßŸàŸÑ€åŸá ÿßÿ≤ backend ÿ®ÿ±ÿß€å JavaScript -->
<script>
window.APP_CONFIG = {
    USER_ID: "{{ request.session.telegram_id }}",
    SOLANA_RPC_URL: "{{ config.SOLANA_RPC }}",
    COMMISSION_AMOUNT: {{ config.COMMISSION_AMOUNT if config.COMMISSION_AMOUNT else 0.1 }},
    ADMIN_WALLET: "{{ config.ADMIN_WALLET }}",
    // ŸÖŸÇÿßÿØ€åÿ± string ÿ®Ÿá boolean ÿ™ÿ®ÿØ€åŸÑ ŸÖ€å‚Äåÿ¥ŸàÿØ
    INITIAL_TASKS_COMPLETED: {{ 'true' if tasks_completed else 'false' }},
    INITIAL_INVITED_FRIENDS: {{ 'true' if invited else 'false' }},
    INITIAL_WALLET_CONNECTED: {{ 'true' if wallet_connected else 'false' }},
    INITIAL_COMMISSION_PAID: {{ 'true' if commission_paid else 'false' }},
    INITIAL_WALLET_ADDRESS: "{{ user_wallet_address if user_wallet_address else '' }}"
};

// Debug ŸÑÿß⁄Ø ÿ®ÿ±ÿß€å ÿ®ÿ±ÿ±ÿ≥€å ŸÖŸÇÿßÿØ€åÿ±
console.log("APP_CONFIG:", window.APP_CONFIG);
</script>

<script src="{{ url_for('static', path='js/airdrop.js') }}"></script>
</body>
</html>
